var croppie_width = 0, croppie_height = 0, croppie_viewport_width = 0, croppie_viewport_height = 0, croppie_basepath = "", croppie_source = "", croppie_result = "", croppie_preview = "", set_size = !1; function ClearImageModelField(){$("#croppie_hidden_file_input").val(""), $("#croppie_hidden_file_input").hide(), $("#croppie_modal_img").croppie("destroy"), croppie_width = 0, croppie_height = 0, croppie_viewport_width = 0, croppie_viewport_height = 0, croppie_source = ""}function InitCroppie(e){$("#croppie_modal_img").croppie("destroy"); var i = new Image; i.src = e, i.onload = function(){0 == set_size && (croppie_width = this.width, croppie_height = this.height), croppie_viewport_width = croppie_width, croppie_viewport_height = croppie_height; var i = "圖片編輯：" + croppie_width + "×" + croppie_height; $("#croppie_modal .modal-title").text(i); var p = croppie_width; p > $("#croppie_modal .modal-dialog").width() && (p = $("#croppie_modal .modal-dialog").width() - 32), croppie_viewport_width >= p && (croppie_viewport_height *= p / croppie_viewport_width, croppie_viewport_width = p), $("#croppie_modal_img").croppie({url:e, viewport:{width:croppie_viewport_width, height:croppie_viewport_height, type:"square"}, boundary:{width:croppie_viewport_width, height:croppie_viewport_height}, showZoomer:!0, enableResize:!1, enableOrientation:!0, maxZoomedCropWidth:100, enforceBoundary:!0}), $("#croppie_modal_img").croppie("bind", {url:e})}}$("#croppie_modal").on("shown.bs.modal", function(e){$(this).css("z-index", 1e4), $(this).find(".modal-content, .modal-body").css({width:"100%", height:"auto", "max-height":"100%"}), ClearImageModelField(); var i = $(e.relatedTarget); croppie_width = null !== i.data("width")?i.data("width"):300, croppie_height = null !== i.data("height")?i.data("height"):300, croppie_basepath = null !== i.data("basepath")?i.data("basepath"):"", croppie_source = null !== i.data("source")?i.data("source"):"", croppie_result = null !== i.data("result")?i.data("result"):"", croppie_preview = null !== i.data("preview")?i.data("preview"):""; var p = "圖片編輯"; croppie_width || croppie_height?(set_size = !0, p = "圖片編輯：" + croppie_width + "×" + croppie_height):(set_size = !1, croppie_width = 300, croppie_height = 300), $("#croppie_modal .modal-title").text(p), "" === croppie_result && $("#croppie_modal").hide(), "" !== croppie_source && ($("#croppie_file_input").val($(croppie_source).val()), InitCroppie(croppie_basepath + $(croppie_source).val()))}), $("#croppie_clear_btn").click(function(){$("#croppie_file_input").val(""), $("#croppie_hidden_file_input").val(""), $("#croppie_hidden_file_input").hide(), $("#croppie_modal_img").croppie("destroy")}), $("#croppie_confirm_btn").click(function(){try{$("#croppie_modal_img").croppie("result", {type:"canvas", size:{width:croppie_width, height:croppie_height}}).then(function(e){$(croppie_source).val($("#croppie_file_input").val()).trigger("change"), $(croppie_result).val(e).trigger("change"), $(croppie_preview).attr("src", e).trigger("change"), $("#croppie_modal").modal("hide"), ClearImageModelField()})} catch (e){$(croppie_source).val("").trigger("change"), $(croppie_result).val("").trigger("change"), $(croppie_preview).attr("src", "").trigger("change"), $("#croppie_modal").modal("hide"), ClearImageModelField()}}), $("#croppie_file_btn").click(function(){$("#croppie_hidden_file_input").click()}), $("#croppie_hidden_file_input").change(function(){$("#croppie_modal_img").croppie("destroy"); var e = $("#croppie_hidden_file_input")[0].files[0]; if (e){var i = new FileReader; i.onload = function(i){InitCroppie(i.target.result), $("#croppie_file_input").val(e.name), $("#croppie_hidden_file_input").val("")}, i.readAsDataURL(e)} else ClearImageModelField()}), $(document).on("hidden.bs.modal", ".modal", function(){$(".modal:visible").length && $(document.body).addClass("modal-open")});